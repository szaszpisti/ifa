<?
if (defined("fogadoora.class")) return;
define("fogadoora.class", "1");

include("fogado.inc");

class Fogadoora {

/*
valid: Ha bejelentkezési idõszak van -- különben csak az admin éri el
IDO_min:  a kiírást ennél a páros idõpontnál kell kezdeni
IDO_max:  ezt a páros idõpontot már nem kell kiírni
*/

	function Fogadoora() {
		# az utolsó id az éppen aktuális fogadóóra
		if ($res = pg_query("SELECT * FROM Fogado_admin WHERE id=(SELECT MAX(id) FROM Fogado_admin)" )) {
			if (pg_num_rows($res) == 1) {
				$u = pg_fetch_assoc($res);
				while(list($k, $v) = each($u)) $this->$k = $v;
				$MaiDatum = date("Y-m-d H:i:s");
				$this->valid = ( ($this->valid_kezd <= $MaiDatum) && ($MaiDatum <= $this->valid_veg) );
			}
			# Megkeressük a Fogado táblában a legkisebb és legnagyobb páros idõket
			if ( ($res = pg_query("SELECT min(ido) AS min, max(ido) AS max FROM Fogado WHERE fid=".$this->id)) && (pg_num_rows($res)==1) ) {
				$Idoszak = pg_fetch_assoc($res);
				$this->IDO_min = $Idoszak['min']-($Idoszak['min']%2);
				$this->IDO_max = $Idoszak['max']-($Idoszak['max']%2)+2;
			}
		}
	}
}

?>
